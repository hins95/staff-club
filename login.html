<html lang="en" ng-app="StaffClubApp">

    <head>
        <base href="/staff-club/">
        <link rel="stylesheet" href="./stylesheet/main.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/0.8.3/angular-material.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700,400italic">
        <!--<meta name="viewport" content="initial-scale=1, maximum-scale=1" />-->
        <title>Staff Club > Login</title>
    </head>

    <body layout="column" ng-controller="AppCtrl">
        <div layout="row" flex>
            <md-sidenav layout="column" class="md-sidenav-left md-whiteframe-z2" md-is-locked-open="1">
                <md-toolbar>
                    <div class="md-toolbar-tools">
                        <h2><span>Poly U Staff Club</span></h2>
                    </div>
                </md-toolbar>
                <md-list ng-controller="LinkMenuCtrl">
                    <md-item>
                        <md-subheader class="md-primary">Hot Links</md-subheader>
                    </md-item>
                    <md-item ng-repeat="menuLink in menuLinks">
                        <a href="{{menuLink.href}}" class="md-button">
                            <md-button>
                                {{menuLink.name}}
                            </md-button>
                        </a>
                    </md-item>
                </md-list>
                <md-content class="md-padding">
                    <md-button ng-click="toggleSidenav('left')" class="md-primary" hide-gt-sm>
                        Close Sidenav Left
                    </md-button>
                </md-content>
            </md-sidenav>
            <div flex id="content">
                <md-toolbar layout="row">
                    <button ng-click="toggleSidenav('left')" hide-gt-sm class="menuBtn">
                        <span class="visually-hidden">Menu</span>
                    </button>
                    <h1 class="md-toolbar-tools" layout-align-gt-sm="left">Login</h1>
                </md-toolbar>

                <md-content layout="column" class="md-padding" ng-controller="LoginCtrl">
                    <section data-ng-init="showMessageToast(message)" ng-if="message"></section>
                    <section id="bottom">
                        <h2 class="md-title">Account Login</h2>
                        <form name="loginForm" ng-model="login.form" ng-submit="submit()">
                            <section layout="column" layout-align="space-around" flex>
                                <md-input-container>
                                    <label>Staff Number</label>
                                    <input required name="staff_id" ng-model="login.staff_id">
                                </md-input-container>
                                <md-input-container>
                                    <label>Password</label>
                                    <input required type="password" name="password" ng-model="login.password">
                                </md-input-container>
                                <md-button class="md-raised md-primary" ng-type="submit">Login</md-button>
                            </section>
                        </form>
                        {{message}}
                    </section>
                </md-content>
            </div>
        </div>
        <!-- Angular Material Dependencies -->
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-animate.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-aria.min.js"></script>

        <script src="http://ajax.googleapis.com/ajax/libs/angular_material/0.8.3/angular-material.min.js"></script>

        <script src="./script/main.js"></script>
        <!-- php json goes here -->
        <script>
            //loginError = true;
            app.controller('AppCtrl', function ($scope, $mdToast, $location) {
                $scope.message = $location.search()['msg'];
                $scope.showMessageToast = function (message) {
                    if (message == 'loginSuccess') {
                        $mdToast.show(
                            $mdToast.simple()
                            .content('Login Success!')
                            .position('top right')
                            .action('OK')
                        ).then($location.url('index.php?msg=loginSuccess'));
                    } else if (message == 'loginError') {
                        $mdToast.show(
                            $mdToast.simple()
                            .content('Login failed!')
                            .position('top right')
                            .action('OK')
                        ).then($location.url('login.html?msg=loginError'));
                    }
                };
            })
            .controller('LoginCtrl', function ($scope, $mdToast, $http, $mdToast) {
                $scope.submit = function() {
                    $http.post('login.php', {
                        staff_id: $scope.login.staff_id,
                        password: $scope.login.password
                    }).
                    success(function(data, status, headers, config) {
                        $scope.showMessageToast(data);
                    });
                };
            })
        </script>
    </body>

</html>